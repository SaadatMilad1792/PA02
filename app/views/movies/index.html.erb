<p style="color: green"><%= notice %></p>

<% content_for :title, "Movies" %>

<h1>Movies</h1>

<table id="movies-table" class="movies-table">
  <thead>
    <tr>
      <th onclick="sortTable(0)">Title <span class="sort-indicator" id="title-indicator"></span></th>
      <th onclick="sortTable(1)">Rating <span class="sort-indicator" id="rating-indicator"></span></th>
      <th onclick="sortTable(2)">Release Date <span class="sort-indicator" id="release-date-indicator"></span></th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% if @movies.any? %>
      <% @movies.each do |movie| %>
        <tr>
          <td><%= movie.title %></td>
          <td><%= movie.rating %></td>
          <td><%= movie.release_date.strftime("%B %d, %Y") if movie.release_date %></td>
          <td>
            <%= link_to "Show", movie %>
            <%= link_to "Edit", edit_movie_path(movie) %>
            <%= link_to "Delete", movie, method: :delete, data: { confirm: "Are you sure?" } %>
          </td>
        </tr>
      <% end %>
    <% else %>
      <tr>
        <td colspan="4">No movies available.</td>
      </tr>
    <% end %>
  </tbody>
</table>

<%= link_to "New movie", new_movie_path %>

<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
    margin: 20px;
  }

  h1 {
    color: #333;
    text-align: center;
  }

  .movies-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
  }

  .movies-table th,
  .movies-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
  }

  .movies-table th {
    background-color: #4CAF50;
    color: white;
    cursor: pointer; /* Change cursor to pointer on hover */
  }

  .movies-table th:hover {
    background-color: #45a049; /* Darker green on hover */
  }

  .movies-table tr:nth-child(even) {
    background-color: #f9f9f9; /* Light gray for even rows */
  }

  .sort-indicator {
    margin-left: 5px;
    font-size: 0.8em; /* Smaller size for the indicator */
  }

  .sort-indicator.asc::after {
    content: "▲"; /* Ascending sort indicator */
  }

  .sort-indicator.desc::after {
    content: "▼"; /* Descending sort indicator */
  }

  .movies-table td {
    position: relative; /* Positioning for action buttons */
  }

  .movies-table td a {
    margin-right: 10px; /* Space between action links */
    text-decoration: none; /* Remove underline */
    color: #007BFF; /* Blue color for links */
  }

  .movies-table td a:hover {
    text-decoration: underline; /* Underline on hover */
  }
</style>

<script>
  function sortTable(columnIndex) {
    const table = document.getElementById("movies-table");
    const tbody = table.tBodies[0];
    const rows = Array.from(tbody.rows);
    const isAscending = tbody.dataset.sortDirection === "asc";

    // Clear previous sort indicators
    clearSortIndicators();

    // Sort rows
    rows.sort((a, b) => {
      const aText = a.cells[columnIndex].innerText;
      const bText = b.cells[columnIndex].innerText;

      // Determine the type of sorting based on column
      if (columnIndex === 1) {
        return isAscending
          ? parseFloat(aText) - parseFloat(bText)
          : parseFloat(bText) - parseFloat(aText);
      } else if (columnIndex === 2) {
        return isAscending
          ? new Date(aText) - new Date(bText)
          : new Date(bText) - new Date(aText);
      } else {
        return isAscending
          ? aText.localeCompare(bText)
          : bText.localeCompare(aText);
      }
    });

    // Clear the table body and re-add sorted rows
    rows.forEach(row => tbody.appendChild(row));
    // Toggle sort direction
    tbody.dataset.sortDirection = isAscending ? "desc" : "asc";

    // Update sort indicators
    updateSortIndicators(columnIndex, tbody.dataset.sortDirection);
  }

  function clearSortIndicators() {
    const indicators = document.querySelectorAll('.sort-indicator');
    indicators.forEach(indicator => {
      indicator.classList.remove('asc', 'desc');
    });
  }

  function updateSortIndicators(columnIndex, direction) {
    const indicator = document.querySelector(`#movies-table th:nth-child(${columnIndex + 1}) .sort-indicator`);
    if (direction === "asc") {
      indicator.classList.add('asc');
    } else {
      indicator.classList.add('desc');
    }
  }
</script>
