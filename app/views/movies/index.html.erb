<p style="color: green"><%= notice %></p>

<% content_for :title, "Movies" %>

<h1>Movies</h1>

<table id="movies-table">
  <thead>
    <tr>
      <th onclick="sortTable(0)">Title</th>
      <th onclick="sortTable(1)">Rating</th>
      <th onclick="sortTable(2)">Release Date</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% if @movies.any? %>
      <% @movies.each do |movie| %>
        <tr>
          <td><%= movie.title %></td>
          <td><%= movie.rating %></td>
          <td><%= movie.release_date.strftime("%B %d, %Y") if movie.release_date %></td>
          <td>
            <%= link_to "Show", movie %>
            <%= link_to "Edit", edit_movie_path(movie) %>
            <%= link_to "Delete", movie, method: :delete, data: { confirm: "Are you sure?" } %>
          </td>
        </tr>
      <% end %>
    <% else %>
      <tr>
        <td colspan="4">No movies available.</td>
      </tr>
    <% end %>
  </tbody>
</table>

<%= link_to "New movie", new_movie_path %>

<script>
  function sortTable(columnIndex) {
    const table = document.getElementById("movies-table");
    const tbody = table.tBodies[0];
    const rows = Array.from(tbody.rows);
    const isAscending = tbody.dataset.sortDirection === "asc";

    // Sort rows
    rows.sort((a, b) => {
      const aText = a.cells[columnIndex].innerText;
      const bText = b.cells[columnIndex].innerText;

      // Determine the type of sorting based on column
      if (columnIndex === 1) {
        // For rating, convert to a number for sorting
        return isAscending
          ? parseFloat(aText) - parseFloat(bText)
          : parseFloat(bText) - parseFloat(aText);
      } else if (columnIndex === 2) {
        // For release date, parse date strings
        return isAscending
          ? new Date(aText) - new Date(bText)
          : new Date(bText) - new Date(aText);
      } else {
        // For title, sort as strings
        return isAscending
          ? aText.localeCompare(bText)
          : bText.localeCompare(aText);
      }
    });

    // Clear the table body and re-add sorted rows
    rows.forEach(row => tbody.appendChild(row));
    // Toggle sort direction
    tbody.dataset.sortDirection = isAscending ? "desc" : "asc";
  }
</script>
